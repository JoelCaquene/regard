{% extends "base.html" %}
{% load static %}

{% block title %}Minha Equipa{% endblock %}

{% block content %}
<div class="page-header-custom">
    <h1>Minha Equipa <i class="fas fa-users"></i></h1>
</div>
<div class="team-container-custom">

    {# √Årea de Resumo - Cards Personalizados (Novo Layout com 2 por linha) #}
    <div class="summary-area-cards">
        
        {# Card: Membros Totais #}
        <div class="indicator-card card-total-members">
            <i class="fas fa-users card-icon"></i>
            <h3 class="card-title">TOTALIT√â</h3>
            <p class="card-value">{{ team_count }}</p>
        </div>
        
        {# Card: Investidores #}
        <div class="indicator-card card-total-invested">
            <i class="fas fa-money-check-alt card-icon"></i>
            <h3 class="card-title">INVESTISSEURS</h3>
            <p class="card-value">{{ total_investors }}</p>
        </div>
        
        {# Card: Subs√≠dios (RKZ) - Ocupa a segunda linha, alinhado √† direita #}
        <div class="indicator-card card-subsidy-balance">
            <i class="fas fa-gem card-icon"></i>
            {# O valor do subs√≠dio no seu exemplo est√° no formato KZ 2000,00, alterando o RKZ para KZ, se necess√°rio, ou mantendo RKZ conforme seu c√≥digo original. #}
            <p class="card-value">KZ {{ subsidy_balance|floatformat:2 }}</p> 
        </div>

        {# O card de "N√£o Investidos" foi removido daqui para seguir a imagem. #}
        
    </div>
    
    {# Link de Convite - Mantido na Estrutura Abaixo dos Cards #}
    <div class="invite-link-section">
        <h3>Link de Convite <i class="fas fa-link"></i></h3>
        <div class="invite-box">
            <span id="invite-link">{{ invite_link }}</span>
            <button class="copy-button" data-clipboard-target="#invite-link">
                <i class="fas fa-copy"></i> Copiar
            </button>
        </div>
    </div>

    {# Membros por N√≠vel - Adaptado para o novo layout visual da imagem #}
    <div class="team-members-list tab-style-container">
        <h3>Membros por N√≠vel <i class="fas fa-layer-group"></i></h3>
        
        <div class="tabs">
            <div class="tab-buttons">
                {# L√≥gica de Abas Django - MANTIDA #}
                {% for data in levels_data %}
                    {# A aba "N√£o Investido" agora tem a cor do bot√£o ajustada para verde, conforme a imagem, mantendo a vari√°vel original para a l√≥gica Django. #}
                    <button class="tab-button {% if forloop.first %}active{% endif %} {% if data.name == 'N√£o Investido' %}tab-nao-investido{% else %}tab-investido{% endif %}" onclick="openTab(event, 'tab-{{ data.name|slugify }}')">
                        {{ data.name }} ({{ data.count }})
                    </button>
                {% endfor %}
            </div>

            <div class="tab-content-container">
                {# L√≥gica de Conte√∫do de Abas Django - MANTIDA #}
                {% for data in levels_data %}
                    <div id="tab-{{ data.name|slugify }}" class="tab-content {% if forloop.first %}active{% endif %}">
                        {% if data.members %}
                            <div class="team-grid">
                                {% for member in data.members %}
                                    <div class="member-card {% if data.name == 'N√£o Investido' %}not-invested-card{% else %}invested-card{% endif %}">
                                        {# √çcone de telefone ALTERADO para 'fas fa-phone-square-alt' e cor personalizada #}
                                        <p class="phone-number"><i class="fas fa-phone-square-alt member-icon-phone"></i> {{ member.phone_number }}</p>
                                        {# √çcone de data ALTERADO para 'far fa-calendar-check' e cor personalizada #}
                                        <p class="date-joined"><i class="far fa-calendar-check member-icon-date"></i> Desde: {{ member.date_joined|date:"d/m/Y" }}</p>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            {# Mensagem de "Nenhum membro neste n√≠vel." na div #}
                            <div class="no-members-message-box">
                                <i class="fas fa-exclamation-circle"></i> Nenhum membro neste n√≠vel.
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

---

<style>
    /* Estilos de Fundo e Layout */
    body {
        background-color: #f8f9fa; 
        margin: 0; /* IMPEDE ROLAGEM HORIZONTAL */
        padding: 0;
        overflow-x: hidden; /* IMPEDE ROLAGEM HORIZONTAL NO BODY */
    }
    .page-header-custom {
        text-align: center;
        padding: 20px 15px; /* Ajuste para mobile */
        background-color: #ffffff;
        border-bottom: 3px solid #00aaff;
        margin-bottom: 20px;
    }
    .page-header-custom h1 {
        color: #343a40;
        font-family: 'Arial', sans-serif;
        font-size: 2rem;
    }
    .team-container-custom {
        background-color: #ffffff;
        padding: 25px;
        border-radius: 12px;
        margin: 20px auto;
        max-width: 950px;
        width: calc(100% - 40px); /* Garante que haja um pequeno espa√ßo nas laterais */
        box-sizing: border-box; /* Garante que padding e border sejam inclu√≠dos no width */
        box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
        color: #343a40;
    }

    /* üí° Cards de Indicadores (Layout 2 por linha) - MANTIDOS */
    .summary-area-cards {
        display: grid;
        grid-template-columns: repeat(2, 1fr); 
        gap: 20px;
        margin-bottom: 40px;
        border: 2px solid #343a40; 
        padding: 15px;
        border-radius: 8px;
        align-items: center;
    }
    .indicator-card {
        background-color: transparent; border: none; padding: 0; text-align: left; box-shadow: none; 
        display: flex; flex-direction: column; justify-content: center; align-items: flex-start;
    }
    .indicator-card.card-subsidy-balance {
        text-align: right; align-items: flex-end; grid-column: 1 / span 2; 
        flex-direction: row; justify-content: flex-end;
    }
    .indicator-card .card-icon { font-size: 2.0rem; margin-right: 5px; color: #00aaff; }
    .indicator-card.card-total-members .card-icon { color: #00aaff; }
    .indicator-card.card-total-invested .card-icon { color: #28a745; }
    .indicator-card.card-subsidy-balance .card-icon { color: gold; font-size: 3.0rem; }
    .card-title { font-size: 0.9rem; order: 2; color: #6c757d; }
    .card-value { font-size: 1.5rem; font-weight: bold; margin: 0; color: #343a40; order: 1; }
    .indicator-card.card-subsidy-balance .card-value { font-size: 2.8rem; margin-right: 10px; }
    .indicator-card.card-subsidy-balance .card-title { font-size: 1rem; font-weight: 600; color: #343a40; order: 2; align-self: flex-start; }
    .indicator-card.card-subsidy-balance { display: flex; align-items: center; }
    .indicator-card.card-total-members, .indicator-card.card-total-invested { display: flex; flex-direction: row; align-items: center; justify-content: flex-start; }
    /* --- FIM Cards de Indicadores --- */

    /* --- Se√ß√µes e Abas --- */
    .invite-link-section h3, .team-members-list h3 { color: #343a40; font-size: 1.3rem; font-weight: bold; }
    .invite-box {
        background-color: #ffffff; padding: 12px; border-radius: 8px; 
        display: flex; justify-content: space-between; align-items: center; 
        margin-bottom: 30px; border: 1px solid #ced4da; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    /* AJUSTE CHAVE PARA LINK LONGO EM MOBILE */
    .invite-box span {
        flex-grow: 1;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis; /* Adiciona '...' se o texto for muito longo */
        min-width: 0; 
        margin-right: 10px;
    }
    .copy-button {
        background-color: #007bff; color: #fff; border: none; padding: 8px 15px; 
        border-radius: 6px; cursor: pointer; font-weight: bold; margin-left: 10px; white-space: nowrap;
    }
    .tab-buttons { display: flex; flex-wrap: nowrap; /* Ser√° alterado para 'wrap' no mobile */ width: 100%; }
    .tab-button {
        background-color: #f1f1f1; color: #495057; border: 1px solid #ced4da; padding: 10px 15px; 
        cursor: pointer; font-size: 0.9rem; border-radius: 0; margin-bottom: 0; white-space: nowrap; flex-grow: 1;
    }
    .tab-nao-investido { background-color: #28a745; color: #fff; font-weight: bold; }
    .tab-button.active { background-color: #28a745; color: #fff; font-weight: bold; border-color: #28a745; z-index: 1; position: relative; }
    .tab-style-container { border: 1px solid #ced4da; border-radius: 6px; padding: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-top: 20px; }
    .no-members-message-box { color: #6c757d; text-align: center; padding: 30px; background-color: #f1f1f1; border-radius: 8px; border: 1px solid #ced4da; margin-top: 15px; }
    /* --- FIM Se√ß√µes e Abas --- */


    /* üöÄ NOVO ESTILO DOS CARDS DE MEMBROS CADASTRADOS üöÄ */
    .team-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* Min-width reduzido para mobile */
        gap: 15px;
        padding: 5px 0;
    }
    .member-card {
        background-color: #ffffff; border-radius: 10px; padding: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
        border-left: none; transition: transform 0.2s, box-shadow 0.2s; border: 1px solid #e0e0e0;
    }
    .invested-card { border-top: 4px solid #17a2b8; }
    .not-invested-card { border-top: 4px solid #dc3545; }
    .member-card p { margin: 5px 0; color: #495057; font-size: 0.95rem; display: flex; align-items: center; word-break: break-all; }
    .phone-number { font-weight: bold; color: #343a40; font-size: 1rem; }
    .date-joined { font-size: 0.85rem; color: #6c757d; }
    .member-icon-phone { margin-right: 8px; color: #007bff; font-size: 1.2rem; }
    .member-icon-date { margin-right: 8px; color: #ffc107; font-size: 1.1rem; }
    /* FIM NOVO ESTILO DOS CARDS DE MEMBROS CADASTRADOS */


    /* Media query para responsividade (Melhorado para mobile) */
    @media (max-width: 768px) {
        /* Para tablets/mobile grandes */
        .summary-area-cards {
            grid-template-columns: 1fr; /* 1 card por linha */
        }
        .indicator-card.card-subsidy-balance {
            grid-column: 1 / span 1; 
            justify-content: flex-start;
            text-align: left;
            align-items: flex-start;
        }
        .indicator-card.card-subsidy-balance .card-value {
            font-size: 2.0rem; 
        }
    }
    
    @media (max-width: 576px) {
        /* Para smartphones */
        .team-container-custom {
            padding: 15px; /* Reduz padding */
            width: 100%;
        }
        .tab-buttons {
            flex-wrap: wrap; /* PERMITE QUE OS BOT√ïES DE ABAS QUEBREM LINHA */
            gap: 5px; /* Adiciona um pequeno espa√ßo entre os bot√µes */
        }
        .tab-button {
            flex-grow: 1; 
            min-width: 45%; /* Garante que caibam 2 ou mais por linha */
            margin-bottom: 5px;
            font-size: 0.8rem;
            padding: 8px 10px;
        }
        .team-grid {
            grid-template-columns: 1fr; /* 1 card por linha em telas muito pequenas */
        }
        /* AJUSTE CHAVE PARA LINK E BOT√ÉO EM MOBILE */
        .invite-box {
            flex-direction: column; /* Link em cima, bot√£o em baixo */
            align-items: flex-start;
        }
        .invite-box span {
            width: 100%;
            margin-bottom: 10px;
            margin-right: 0;
            white-space: normal; /* Permite que o texto quebre */
            word-break: break-all; /* For√ßa quebra de linha se necess√°rio */
        }
        .copy-button {
            width: 100%;
            margin-left: 0;
        }
    }
</style>

<script>
    // L√≥gica das Abas (MANTIDA)
    function openTab(evt, tabName) {
        let i, tabcontent, tabbuttons;

        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            tabcontent[i].classList.remove("active");
        }

        tabbuttons = document.getElementsByClassName("tab-button");
        for (i = 0; i < tabbuttons.length; i++) {
            tabbuttons[i].classList.remove("active");
        }

        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    // Abre a primeira aba por padr√£o ao carregar (MANTIDA)
    document.addEventListener('DOMContentLoaded', (event) => {
        const firstTabButton = document.querySelector('.tab-button');
        if (firstTabButton) {
            firstTabButton.click(); 
        }
    });


    // L√≥gica para Copiar Link (MANTIDA)
    document.addEventListener('DOMContentLoaded', function() {
        const copyButton = document.querySelector('.copy-button');
        if (copyButton) {
            copyButton.addEventListener('click', function(e) {
                const linkElement = document.getElementById('invite-link');
                const textToCopy = linkElement.innerText;
                
                navigator.clipboard.writeText(textToCopy)
                    .then(() => {
                        const originalText = e.target.innerHTML;
                        const originalBg = e.target.style.backgroundColor;
                        e.target.innerHTML = '<i class="fas fa-check"></i> Copiado!';
                        e.target.style.backgroundColor = '#28a745';
                        setTimeout(() => {
                            e.target.innerHTML = originalText;
                            e.target.style.backgroundColor = originalBg;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Falha ao copiar: ', err);
                        alert('Erro ao copiar o link. Tente copiar manualmente.');
                    });
            });
        }
    });
</script>
{% endblock %}
